<!DOCTYPE html><html lang="en"><head>
<base href="https://seantodd.co.uk/blog/putting-2fa-on-everything/">
<link rel="icon" data-savepage-href="" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFlJREFUeNpi1NLSYqAlYGKgMRi1YOAtYMEUunr1Ki7V2traxChABoy4kimaKZg6CSoYjeRRC4ZyRiMmWwxBHxDMyaOpaNSCIWwBlhqNTlXmaByMWkA0AAgwALYzGbpFLhDxAAAAAElFTkSuQmCC">
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.73.0">

    
    
    

<title>Adding 2-Factor Authentication to any Web App using Nginx • Sean's Blog</title>


<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Adding 2-Factor Authentication to any Web App using Nginx">
<meta name="twitter:description" content="Adding 2-Factor Authentication to any Web App using Nginx and PHP">

<meta property="og:title" content="Adding 2-Factor Authentication to any Web App using Nginx">
<meta property="og:description" content="Adding 2-Factor Authentication to any Web App using Nginx and PHP">
<meta property="og:type" content="article">
<meta property="og:url" content="https://seantodd.co.uk/blog/putting-2fa-on-everything/">
<meta property="article:published_time" content="2019-02-20T19:30:01+00:00">
<meta property="article:modified_time" content="2019-02-20T19:30:01+00:00"><meta property="og:site_name" content="Friendly Neighbourhood SysAdmin.">


    


<style data-savepage-href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">.hljs{color:#a9b7c6;background:#282b2e;display:block;overflow-x:auto;padding:0.5em}.hljs-number,.hljs-literal,.hljs-symbol,.hljs-bullet{color:#6897BB}.hljs-keyword,.hljs-selector-tag,.hljs-deletion{color:#cc7832}.hljs-variable,.hljs-template-variable,.hljs-link{color:#629755}.hljs-comment,.hljs-quote{color:#808080}.hljs-meta{color:#bbb529}.hljs-string,.hljs-attribute,.hljs-addition{color:#6A8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-id,.hljs-selector-class{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:bold}</style>








<style data-savepage-href="/scss/hyde-hyde.9b9fa5e38e0bfe3fbc637faa5f094ed6d343dc843c2da19e62223f9b56cba721.css">*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:"IBM Plex Sans",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Droid Sans","Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:17px;line-height:1.667em}@media (min-width: 38em){html{font-size:19px}}body{color:#ccc;background-color:#353b43;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#90a959;text-decoration:none}a:hover,a:focus{text-decoration:underline}a strong{color:inherit}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;font-size:85%;border:1px solid #e5e5e5;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}th{text-align:left}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}.container{max-width:38rem;padding-left:1.5rem;padding-right:1.5rem;margin-left:auto;margin-right:auto}footer{margin-bottom:2rem}.page,.post{margin-bottom:4em}.page li+li,.post li+li{margin-top:.25rem}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.related{padding-top:2rem;padding-bottom:2rem;margin-bottom:2rem;border-top:1px solid #eee;border-bottom:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}*{box-sizing:border-box}html{-webkit-text-size-adjust:100%;box-direction:normal;font-family:"IBM Plex Sans",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Droid Sans","Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:17px;line-height:1.667em;font-weight:400}html,body{margin:0;padding:0}h1,h2,h3,h4{font-weight:400}h1{font-size:2.15rem;line-height:1.25;margin-bottom:1rem}h2{font-size:1.85rem;margin-bottom:.5rem}h3{font-size:1.5rem}h4{font-size:1.3rem}h5{font-size:1rem}figure{max-width:100%;margin:0;padding:0}.warning,.important,blockquote{padding:.8889rem;margin-top:1rem;margin-left:0px;margin-right:0px;border-left:6px solid;border-right:6px solid transparent;border-right-width:6px;border-right-style:solid;border-right-color:rgba(0,0,0,0) transparent;color:#7a7a7a}blockquote{background-color:#fafafa;border-left-color:#e6e6e6}.important{background-color:#fbf8e8;border-left-color:#fee450}.warning{background-color:#f2dbdc;border-left-color:#ae272f}kbd{font-family:"IBM Plex Sans",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Droid Sans","Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";padding:2px 7px;border:1px solid #ccc;font-size:0.8em;line-height:1.4;background-color:#f3f3f3;color:#313131;box-shadow:0 0 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;border-radius:3px;display:inline-block;text-shadow:0 1px 0 #fff;white-space:nowrap}a{color:#90a959;text-decoration:none;word-wrap:break-word}a.sidebar-nav-item:hover{border-style:none;text-decoration:none}a.sidebar-nav-item:focus{border-style:none;text-decoration:none}a:focus{color:#ccc;border-bottom:1px dotted #ccc;text-decoration:none;background:transparent;background-color:transparent;word-wrap:break-word}a:focus.tag{border-style:none;text-decoration:none}a:hover{color:#ccc;border-bottom:1px dotted #ccc;text-decoration:none;background:transparent;background-color:transparent;word-wrap:break-word}a:hover.tag{border-style:none;text-decoration:none}a.tag{border-style:none;text-decoration:none}a.read-more-symbol{text-decoration:none;border-style:none;text-decoration:none}.content{padding-bottom:2rem;padding-top:2rem}.sidebar{background-color:#242930;color:#fff;color:rgba(255,255,255,0.5);padding:2rem 1rem;text-align:center}.sidebar a{color:#f9f9f9;border:none}.sidebar a:hover{color:#90a959}.sidebar a:focus{color:#90a959}.sidebar .sidebar-about{text-align:center}.sidebar .author-image{display:block;margin-top:4px}.sidebar-nav{text-align:center;list-style:none;margin-bottom:2rem;margin-top:2rem;padding-left:0}.sidebar-nav-item{display:block;line-height:1.75}.sidebar-nav-item .active{font-weight:bold}.site__title{font-size:1.5rem;margin-bottom:0.5rem}.site__title a:hover{border:none}.site__description{font-size:0.95rem;font-weight:300}.social{text-align:center}.social a{padding:0 4px;border-style:none;text-decoration:none}.img--circle{border-radius:50%}.img--headshot{height:115px;width:115px}.img--caption{font-style:italic}.builtwith,.copyright{font-size:.7rem;line-height:1.1rem;text-align:center}.copyright{padding-top:1rem}.builtwith{padding-top:.2rem}.section__title{font-size:2.15rem}.post-list__item{margin-bottom:3em}.item__title--big{display:block;font-size:1.785rem;line-height:1.25}.item__title--small{font-size:1rem}.item__date{color:#ccc;display:block;font-size:1rem;margin-bottom:.2rem;margin-top:.2rem}.post__meta{font-size:.8rem;color:#90a959;font-weight:300}.post__category{font-weight:bold}.post__tag{background:#eee;border-radius:2px;color:#606570;font-size:.667rem;font-weight:bold;padding:2px 6px}.post__title{background-image:-webkit-linear-gradient(left, #ff2c2c, #7a5e91);background-image:-moz-linear-gradient(left, #ff2c2c, #7a5e91);background-image:-ms-linear-gradient(left, #ff2c2c, #7a5e91);background-image:-o-linear-gradient(left, #ff2c2c, #7a5e91);background-image:linear-gradient(to right, #ff2c2c, #7a5e91);color:transparent;-webkit-background-clip:text;background-clip:text}.post__subtitle{display:block;font-size:1.5rem;font-style:italic;padding:0 0 1rem 0}#references li{font-size:0.9rem}pre{tab-size:2}pre code{white-space:pre-wrap}code{font-family:"SFMono-Regular","SF-Mono",Menlo,Monaco,Consolas,"Liberation Mono","Roboto Mono","Ubuntu Mono","Courier New",Courier,monospace;font-size:.9rem}code{padding:.1em .1em;color:#ab5979;border-radius:3px}a code{color:#90a959}.hljs{font-family:"SFMono-Regular","SF-Mono",Menlo,Monaco,Consolas,"Liberation Mono","Roboto Mono","Ubuntu Mono","Courier New",Courier,monospace;font-size:.8rem;line-height:1.667em;white-space:pre;border:1px solid #ddd;border-radius:4px}body .gist .gist-data{background-color:#fafafa}body .gist .highlight{background-color:transparent}body .gist td{border:none}ul.pagination{list-style:none}ul.pagination li.page-item{display:inline-block}ul.pagination li.page-item a{padding:0.05em 0.4em}ul.pagination li.page-item.active a{color:#90a959;border-bottom:3px solid #90a959}.navigation{max-width:calc(100% - 0px);margin:0 auto;margin-top:60px}.navigation a{font-size:0.8rem;display:flex;align-items:center;justify-content:center;padding:15px;color:#90a959;border:2px solid #90a959;line-height:1.25;text-transform:uppercase}.navigation a:hover{padding:14px;border-width:3px}.navigation a:nth-child(2){margin-top:10px}.navigation a:first-child:last-child{width:100%}.navigation .fa{font-size:0.8rem}.navigation .navigation-prev{text-align:left}.navigation .navigation-prev .fa{padding-right:10px}.navigation .navigation-prev .navigation-tittle{padding-left:4px}.navigation .navigation-next{text-align:right}.navigation .navigation-next .fa{padding-left:10px}.navigation .navigation-next .navigation-tittle{padding-right:4px}.navigation-single a{text-transform:none}.badge-category,a.badge-category{color:#fff !important;background-color:#0088cc}.badge-category:hover,.badge-category:focus,a.badge-category:hover,a.badge-category:focus{color:#0088cc !important;background:transparent;background-color:transparent;text-decoration:none;border-bottom:none}.badge-tag,a.badge-tag{color:#fff !important;background-color:#7766cc}.badge-tag:hover,.badge-tag:focus,a.badge-tag:hover,a.badge-tag:focus{color:#7766cc !important;background:transparent;background-color:transparent;text-decoration:none;border-bottom:none}.badge{display:inline-block;padding:0.25em 0.4em;font-size:0.75rem;font-weight:bold;line-height:1;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:0.25rem}.portfolio__content section{margin-bottom:1.765rem}.portfolio__featured-project{margin:0 0 1.765rem}.portfolio__featured-project img{margin:0 0 1rem;box-shadow:1px 1px #eee}.project__image{border:1px solid #eee;box-shadow:1px 1px #eee}.project__title{margin-top:1.765rem;letter-spacing:1px;font-size:1.85rem}.project__subtitle-small,.project__subtitle-big{font-style:italic;color:#778492;display:block;margin-top:0.5rem;margin:0 0 1rem}.project__subtitle-big{font-size:1.5rem}.project__subtitle-small{font-size:1.3rem}.project__featured-image{position:relative}.project__summary{margin-bottom:1.765rem;text-align:left}.divider{margin-bottom:3.5rem}.row-space{margin-bottom:1rem}.col-md-8,.col-sm-8,.col-md-4,.col-sm-4,.col-xs-12{min-height:1px;padding-left:15px;padding-right:15px;position:relative}.row{margin-left:-15px;margin-right:-15px}.col-xs-12{width:100%}.img-responsive{display:block;max-width:100%;height:auto}@media (min-width: 320px) and (max-width: 767px){html,body{font-size:17px}.sidebar li{padding:.1rem 0}.sidebar .container{padding-left:0;padding-right:0}.hidden-tablet{display:none}.sidebar-about,.copyright{display:none}.sidebar{margin:0;padding:0}.menu-content{padding:0 0 0 0px;max-height:0;overflow:hidden;margin-top:0}.collapsible-menu{padding:0px 0px}.collapsible-menu ul{list-style-type:none;padding:0}.collapsible-menu li{display:block}.collapsible-menu a{text-decoration:none;cursor:pointer}.collapsible-menu label{background:/*savepage-url=/img/menu-open.svg*/url() no-repeat left center;background-position:1.5rem;display:block;cursor:pointer;color:#fff;padding:10px 0 10px 0px}input#menuToggle{display:none}input#menuToggle+label{font-weight:bold}input#menuToggle:checked+label{background-image:/*savepage-url=/img/menu-close.svg*/var(--savepage-url-6);background-position:1.5rem;color:#fff}input#menuToggle:checked~.menu-content{max-height:100% !important}.social{padding:1em 0 1em 0}}@media (min-width: 768px){html,body{font-size:17px}.sidebar{bottom:0;left:0;position:fixed;text-align:left;top:0;width:15rem}.sidebar-sticky{left:1rem;position:absolute;right:1rem;top:1rem}.content{margin-left:17rem;margin-right:2rem;max-width:70rem}.layout-reverse .sidebar{left:auto;right:0}.layout-reverse .content{margin-left:2rem;margin-right:17rem}.col-sm-8{width:66.66666667%}.project__title{margin-top:0.2rem}.navigation{display:flex;justify-content:space-between}.navigation a{width:calc(50% - 10px)}.navigation a:nth-child(2){margin-top:0}input#menuToggle,input#menuToggle+label{display:none}}@media (min-width: 992px){html,body{font-size:19px}.layout-reverse .content{margin-left:4rem;margin-right:22rem}.col-md-4{float:left;width:33.33333333%}.col-md-8{float:left;width:66.66666667%}.portfolio-container{width:68rem}}.element--center{display:block;margin-left:auto;margin-right:auto}.menu{background-color:#f3f3f3;color:#333;border-radius:2px;padding:1px 5px}.text-center{text-align:center}.pull-right{float:right}.draft{color:#999 !important}.theme-base-08 .sidebar{background-color:#ac4142}.theme-base-08 .content a{color:#ac4142}.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .sidebar{background-color:#d28445}.theme-base-09 .content a{color:#d28445}.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .sidebar{background-color:#f4bf75}.theme-base-0a .content a{color:#f4bf75}.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .sidebar{background-color:#90a959}.theme-base-0b .content a{color:#90a959}.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .sidebar{background-color:#75b5aa}.theme-base-0c .content a{color:#75b5aa}.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .sidebar{background-color:#6a9fb5}.theme-base-0d .content a{color:#6a9fb5}.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0e .sidebar{background-color:#aa759f}.theme-base-0e .content a{color:#aa759f}.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .sidebar{background-color:#8f5536}.theme-base-0f .content a{color:#8f5536}.theme-base-0f .related-posts li a:hover{color:#8f5536}

/*# sourceMappingURL=hyde-hyde.css.map */</style>


<style data-savepage-href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" media="print">@page{margin:1cm !important}body{font-size:17px;line-height:1.3;background:#fff;color:#000}.content{margin:0 auto;width:100%;float:none;display:initial}.container{width:100%;float:none;display:initial;padding-left:1rem;padding-right:1rem;margin:0 auto}img{max-width:100%}blockquote,ul{margin:0}.sidebar{display:none !important}.navigation{display:none !important}.post__related{display:none !important}.gist-meta{display:none !important}#disqus_thread{display:none !important}

/*# sourceMappingURL=print.css.map */</style>




<style data-savepage-href="/scss/hugo-toc.6981afc22bddc24e28345c1d57aa8c2ecfb46a2427d6abe294176dcd5119e1f0.css">.toc-wrapper{font-size:.9rem;padding:0.5em 0.5em 0.5em 0em;background:#444c57}.toc-wrapper label{background:/*savepage-url=/img/menu-close.svg*/var(--savepage-url-6) no-repeat right center;display:block;cursor:pointer;padding-left:1em}#TableOfContents{overflow:hidden;margin-top:0;max-height:100%}#TableOfContents>ul{list-style-type:none;padding-left:1em}#TableOfContents>ul>li ul{list-style-type:none;padding-left:1em}input#tocToggle{display:none}input#tocToggle+label{font-weight:bold}input#tocToggle:checked+label{background-image:/*savepage-url=/img/menu-open.svg*/url()}input#tocToggle:checked~#TableOfContents{max-height:0}

/*# sourceMappingURL=hugo-toc.css.map */</style>



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" data-savepage-href="/favicon.png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFlJREFUeNpi1NLSYqAlYGKgMRi1YOAtYMEUunr1Ki7V2traxChABoy4kimaKZg6CSoYjeRRC4ZyRiMmWwxBHxDMyaOpaNSCIWwBlhqNTlXmaByMWkA0AAgwALYzGbpFLhDxAAAAAElFTkSuQmCC">
    
    


<style id="savepage-cssvariables">
  :root {
    --savepage-url-6: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIxcHgiIGhlaWdodD0iMjFweCIgdmlld0JveD0iMCAwIDIxIDIxIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHRpdGxlPm1lbnUtY2xvc2U8L3RpdGxlPgogICAgPGRlc2M+Q2xvc2UgSWNvbjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJDb250YWluZXIiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJpY29uLWNsb3NlIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiPgogICAgICAgICAgICA8cGF0aCBkPSJNNSw1IEwxNi4zMTM3MDg1LDE2LjMxMzcwODUiIGlkPSJMaW5lLUNvcHktOCI+PC9wYXRoPgogICAgICAgICAgICA8cGF0aCBkPSJNNSwxNi4zMTM3MDg2IEwxNi4zMTM3MDg0LDUiIGlkPSJMaW5lLUNvcHktNyI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+Cg==);
  }
</style>
<script id="savepage-shadowloader" type="application/javascript">
  "use strict"
  window.addEventListener("DOMContentLoaded",
  function(event)
  {
    savepage_ShadowLoader(5);
  },false);
  function savepage_ShadowLoader(c){createShadowDOMs(0,document.documentElement);function createShadowDOMs(a,b){var i;if(b.localName=="iframe"||b.localName=="frame"){if(a<c){try{if(b.contentDocument.documentElement!=null){createShadowDOMs(a+1,b.contentDocument.documentElement)}}catch(e){}}}else{if(b.children.length>=1&&b.children[0].localName=="template"&&b.children[0].hasAttribute("data-savepage-shadowroot")){b.attachShadow({mode:"open"}).appendChild(b.children[0].content);b.removeChild(b.children[0]);for(i=0;i<b.shadowRoot.children.length;i++)if(b.shadowRoot.children[i]!=null)createShadowDOMs(a,b.shadowRoot.children[i])}for(i=0;i<b.children.length;i++)if(b.children[i]!=null)createShadowDOMs(a,b.children[i])}}}
</script>
<meta name="savepage-url" content="https://seantodd.co.uk/blog/putting-2fa-on-everything/">
<meta name="savepage-title" content="Adding 2-Factor Authentication to any Web App using Nginx • Sean's Blog">
<meta name="savepage-from" content="https://seantodd.co.uk/blog/putting-2fa-on-everything/">
<meta name="savepage-date" content="Mon Sep 21 2020 14:51:49 GMT+0800 (中国标准时间)">
<meta name="savepage-state" content="Basic Items; Retain cross-origin frames; Merge CSS images; Remove unsaved URLs; Max frame depth = 5; Max resource size = 50MB; Max resource time = 10s;">
<meta name="savepage-version" content="22.2">
<meta name="savepage-comments" content="">
  </head>


    <body class=" " style="margin-bottom: 0px;">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      
        
        
        
        <div class="author-image">
          <img data-savepage-src="https://seantodd.co.uk/img/avatar.jpg" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAFgARADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDxtTUmeKiFPrUxDvQDRRimKRIvPua9S8DaDb2OmSa5qAAVB8gbvXmmnw+ffQx4zuYCvRPGOrPbaJZaVEdqbMsBVI5qjvocz4l1+bXNRaQkiIHCLWJRnJpKsqKshaM0meaBSGOp4NMxS96aAsRMM813XhSXzdEv4R1CE/pXn6nDCuz8ETD7RcQH/lomKZlNnKS/JPIv+0aYScVc1WHyNWuUx0c1SNIqL0DPFGaSkpjsOopKXNANhmp7Ub7iNR1LAVXIJrT0C2NzrFvHj+LNOxEnodJ4zlMem2Vseowf0riS3FdV44m3anHFnhEFcoaViYbBS02jNFjUU0ZxTc0uaQrF7TdSn0+6WeFirA8j1FdzqOmQ+K9FGp2YVbqNf3i9zXnAPNdb4I186Vq6RyH9xJ8rA9KRElbU5GZWjlZHBDA4INRA4rufiLocdlfpf2+PKuBu46VwpFI2g7oC1MJpO9ITSGUxTwaYKcKg2HCl9qQU4daaEzoPCNn9q8QWqkZCuCa0PG8u7XWjzxGMCrvwys/P1ySTGRGm6sXxVJ53iS7bOQHIqzla94xs0DmkIoFM2sLilFIaUUAkOpc02iqQmhw61veFrkwa7b88MdprAFWbOc291FKD9xgaDOS0Og8Y2wttad+glG4Vzp5rv/EmmSa3plpf2S+awQBgvNcc2jahj/j1k/KgzjKxQ6ClwKuDR78DBtZPyp/9kXw62sn5UF8xRxSVcbTbsdbeT8qb9huQOYH/ACpiuisBmuq8D2ofU2nbpGprmxZ3G7HlN+Vdxods2jeHrm7nUozj5c96CZPocr4guTdavO+cgMQKyTUk0nmzSSZ5ZiaioKitBaKTNGaC2FFJRSYg71JG5VgynkdKip6UA9TvNaaTUPBFvNIdxhXFedc16bYw/bPh3cqBlkFeZkFW5qWKmxhFNNSGmEVJqUh0pRTRTgazNhwqxbwSzEiKJnI/ujNQLXffDfXNJ0a6uDqYXDj5Sy57VSIk9DZ+Flv5aX8zKVYRkYI9q4PWG36zdse8hr2PQZbW5t9SvrMbYHRscYzXjOqHOp3B9XNM5YSvIqGm5pc8mmmqN7js0A02lFAlKw/NJmkoqkDlcUGnA02lpi6G7o/ijUdF+W3kzF/cPSt5fiRfYy1rETXCU7NBm4I7r/hZF6Txaw0v/CyL3P8Ax5wmuEyaUGgXId6vxFlJzJp0BqYfEOBv9ZpUJ/CvPdxpdxpi5D0A+PtP3f8AIIjB7GsHXvFFzrQEe0RQrwqLXObqXdQHKO7Ugo3cUmaDRA1ApCaAaYC0hNBNNzSYrjhT0HNRg1IjDIpAeoeCI/tXhLUIuvFeXXSbLmRf7rEV6r8M/n0m+j9Qa8v1VDHqlyv/AE0NJkU37xSPWm9adSqu5gFGSTgVLOgzM0opBSisjdkimrEHJqsOtX9Nh868hjxnc4FUjKex7T4Ut3tfBsxKEboyf0ryDUBm/nJ/vmvoOSS0svDAtThX+z9Me1fPd/n7dP7uaq5ywVmMgs57liIInkI67VzUUsbwuUkRlYdiMV3fw68RaXok1wNSC/OuFYrmuf8AGGo2up69Lc2SgRE8YFB0NmAaUUhOaBVIQ40lFGaYMXNLTc0tAh1LSCigGLmikpaZItLTaXNMVwopM0uaYC0tNzRmlcYUUUUXEwoopKBIWnrwRUdSKeRSHY9U+Fx/0W6U981554nhMOv3K/7Rrvfhs5W1nI65xXLfEC0a18RSMRgOM0Mxg/fOSJqW1cJcxM3ADjNQmm5Pes2dSRQFPFMFOBrM6GSDrXReEofP8QWqYyN2TXNjrXafD+HdrAmP/LOritTCs7RPVNccGRox0EFeG6gxF/MP9s17PfzGe4mc/wDPIivF9SJF/N/vmrlGxxYdtsr8t9asPZXEcIlaJxGejY4qCGQRzI5GQGBr0vV/HWkXfg5NOjhH2gIF6dDUnbY8xzS5prcUoNCELmjNJRVCY6lFIKWgBwpaaDS0xi0CkoouIdRSA0tO5LDNFJmgGmIWlpKKQxc0nNFFABmkzzS0UEi0D7wpKco5zQij0v4ettsZT/tiofivbBbu3mA+8MVY8DALpLn/AGhVr4oJ5+mW0oHK5ps44ytUPID1ppNONMNZs9COxSFPFOnt5Ld9silT6GmCsjcevXpXoHgOPy4bqY9ABzXAr1r0TwsPJ8OXMnQtirgcuIfunWs+S5J6xmvINU/5CNx/vmvWV+6vPWLNeT6rxqdwP9s1cmcuGepRzSUtFSdogpwoxQKYx1FApaBMUUuaSimK4tOpoFOxQISjNGKXFMQUZopcU7CA0UYoosIKWkpaAQUmaKKAYUtJRmgYtOBplSL0FCE3oem+DwF0En1Iq74zzdaAR3QVV8LLt8Pp71Z1v97pd2n91M05bHAv4p46c81GambhjUTdayPTTNLxLcw3F3ui249qwxSbi3Xk0oqDoHoDXolkfI8Hpjguf6157GPmr0K4/c+E7FR/GauJyYj4TqEGLdZD0WHOa8l1JvM1Kd+xYmvXNQH2Pwr9objdDgGvHZW3SE9yapnPh1YhNJTyKNtSddxBk0uDSgEUvemFwAopaSgQtKKBRTAcKcKZS5piFopKXNAMBRRRTJFopOaWmhBS4pKWnYYYoxS0lACYpMU6ik0O4mKcnBoAzTlXmglvQ9S8OjGhWqjuK7G/0a2j8PXcpGWeLOa47wcwudGVRy0fFXI9du55NQ092zEqcChrQ5ItKZ43ONtzIvYMRULVavV23cw/2z/OqjdazPQjqinT1pgqVAKzN7ksKlnUe4r0LV18vQtLj9TXC2URlu4kQEkuOK9A8TQvbQ6VDINpyDirRxV5Xdjb8eSC28HWMC8FgPyrzfS9Du9auxBaJubua7/4kCQ6Vp2FPl7AM+9R+AMWGjX+oEYZQVBqmYxdkc9J8ONciziJH9gayrvwxq1kf3tnJx1wK67wnqGo3OpTXj3TmKPJIJ4FLd/E/VI7+ZEhhaJXKgH2osWqjZ569pOhO+J1+opvlMOq4r0T/hZMc4C3mj27juR/+qm/8JD4TvyBc6aYs9SqimXzM87x6ikKnPTivRxp3gm+5S+aA+hWnnwX4cnGbfW059aA5zzYDFLtPpXojfDq3bm31WB/xpp+GF+w3RTxuvqDQN1Ejz7afSjaa7l/htrCj5VDfQ1C3w71sf8ALvn8aCfao43ZRtrsP+Fe65/z6MfxpD8P9cH/AC5t+dAe0RyGKULzXW/8IDro/wCXFvzpp8Ba7/z4t+dAc6OV20oWuqHgPXs/8eTfnUq/D/XGPNoR+NVEXOjkdlN2nPSuzHw+1rvAB/wKpF+Hepkje0a/8Cqg50cTtNGzn1r0CL4cOD+/voU/4FU6+BtGhP8ApOrxr64NAnUR50seT0qRYWP8NejronguzOZdT8wjsBVhNS8E2ePLjMpHqgpC57nmq2jkcISfpTJLd0H3SDXsOp6vptno8V9p+nwyBuuRjFLFpFn4x0OOdIY4Js4YqKTYKd9GYXwyO83ETflTLbjxFqcfsa6bRfDC+GdXVFl8wSrXNwKT4x1BQMkjNSmZyjZ3PNNTGNRuFx0kb+dUSK09XTbqt0MEfvW4/Gs00HZTehTxxT160EcClQcisUbs6vwRbLc6/AGXIVga7Hxyxu9fsYUAAXAFc/8AD6If2mZPQV0mqxm48TWvGdp5rVLQ86tL3y7qWpWeoeXoV9tX92Njns1LcaK2jeCruCGZZ2Y7v3ZzxXnvia7aTXZSjEFeMg0ukeJL7S7gP5jTRn7ySHIIp3EqbaOp0O0kHhO6+yLuuHHzDvXC3NndQyN50UitnnKmvRdPvNM1KT7Rp96LC6PJhJwp/OteSTUQm250m2vF/voBk/lT3BPlPGtrZ5Uj8KdsOOletNbWUp/e+HnU/wCypqRNG0qT/mCyD6g07Fe0PIgh29/wp6xycbVfPsK9mh0HSlwf7KCn/aNXY7TRrblrW1jx3Y0A532PG7WDUmkVYlnyxxwDXqGli70/TYLZ5nMj/eyelacuveHrEfNPagjoEAJrl9c8dabGkgsUMkzjG89qDKXM2Tap8RZtMujaQRBxGMEn1qh/wta7/wCfZa88nne4neR2yzHJNQ7qRoqR6YPixdAD/RFz3p4+LNx/z6ivMS5xilDU7Iv2aPUB8Wps82f61KvxaPexP515XuoDU7IXIerj4soTg2LfmK6O18Tf2lZwXtvmMHh1PNeDb8EV2HhDxLDp2+zvhm3kI+b+7RZGc6b6Gt4t1HXLTUN0d1KIHGRtzgVykmsaq/37ub/vo17Hban4ev7ZYjcW8oxwHIzTJ/DOiXq5W3TB7oaZMXbc8Vkvb1z81zKfq5qJ3lc5Zy31NetzeANJYE7pF+lU38A6R/z+yL9RRoP2iPLe3vTkTJ9q9L/4QjQIzmXUHxSr4f8ADdsflklnPYAdaY+dGd4fP2/w/c2jj7ikrkVs+DZrqHQbyOEnzImJXFWBFLJbG3tLNbK1Iw0r8HFY9z4osvC9q1tphW5uGPzs3TNJq5N7vQ6LRru9mnF3q8gRgCI1NYekEN8QLguPlYVzSeK73VdYgkuCEUHGxeldLEhj8ZLLjAKCpURSk1uch8QdMFh4hkaMYSUlvzrjWHNel/E5A08Mn615s9TI7KErxKWaelRipF4OKzR1SWh6H8PE3STN6GuonQDVnm/uD+lc58PMLb3Lf7QrptTxDZXk567etbLY8qtrUseWXj/adTmOfvOa9e0j4e6VN4WWeVMzvHu359q8WaXbc+YBn5s16xafE+wt/CwtBGftCx7AD9KzZ304+6eYXaGzvJI0cgoxGQatWviTV7PAhv5Qo6AnNZc9wZ5XkPVjk1CeKpEuCOpHjrXhx9tP/fIqOTxtr0g/4/3H0A/wrmgSDShjTuL2aNiXxJq8/wDrL+U/jiqcmoXUx/eXEjfVjVQmilcfIkPaQt94k/U0biaZQDTuKyHZpc02loHYKWkpaYhe1GaO1JTQhc07NNFL3pksmjmeM/K5H0NaFvr+qWpHkXkqgds5rKoBIoJ5Uzq7bx5rluADdbx6MorTi+Jd4FxLawv+FcFk5zRkdutNCdNM9E/4WRGR8+lRE+9RS/Edv+WFhBGex21wOfWkz7UgVJHQal4s1XU8rLdMEP8ACvArDLksSxyaZuppOTQXGKRbspPLu4m9GFetCLfqEFwOrAc147E2HX6ivaNKxcaXaz9wKpHLiEYHj21kvUgijGZGcAVwut+HNR0NYmvYiiyDIJFegeMrx7GKC8jALRyAgGuQ8V+NbrxNBBBLAkaxgDI71hPc6MK/dOHUc1Kg+bio14rQ0mz/ALR1O2tt2wStgn0rNbHczvPAKgWM5778V0fi3Nv4clbH3xitG38HReF9J3x3Bk3sCeKo+OCJvDAKfw9cVsnoeVV0qnjLEhqaTz1pzjmmVmejF2Q4Hiim0tUIWlFIKWgBc0tJS0EhQBRSimIWiilpjEpaKKZLFoxRmimIKXGaSnLTEGKKcTTaAFApMUoNGaBAKMUUtA7jaMUUoNA0KowRXtHhAi48MxdcrXjC17L4CBXwsS3HFNHNiFoYPj/A0hD6vXlrHJIr0/4gnOjx/wDXSvL2rOe5rhvhKi1ZtZ5LadJYm2uhyCKqipU61ijukeveGfEOpa1pBS9m3rGwArQvnW7gubJu6cCua8B86bN/10FX726Nt4mtwT8j8GtklY8qqv3h5pdRGK4kQjBViKgNdD4tsDZazIAPlkG4GufIqLHdB3Q2lpO9OFBQtFLigDjNMQCiiloEJThSUtAhaKKKoQUvNFKKBBRS0lUAtFJThQIKSnYpKYwopaKBCc0ZoooEFHegc04CgZJBGZJkUdScV7Vpe2w0eKzHDAcivL/CentqGsxJj5V+Y131rd/atcu0U/JGoApo5cQ7mJ8QWxpkS/7VeZtXo/xCb/RoU9ea84as57nRhl7pSFSrUQqVKxR2y2PSPAB/0Ccf7dReMmaHUIJFOCORS/Ds7orhP9qtHxJpM+q6la21um52OK1Tsjzpq8xnivS5NR8L2urIu4qAGI9K85ZcV9Arpg0/QrfSbzDJN8mfQmvPtb+H01leuFbER5U1F7s2hpoeeAZNWbKze7vIrdCN0jBRWpqGgvYJuds1n20z2l1HPGBvRgRTNbHZeIfh3LoOhLqDzB8gZHpXBkc16tb3ms/ELSfsWxYoYVw7Z6mvNtUsJNMv5bST7yHBoQmUKWlxRTEJSiigUxC4paKKYhKcKbS0AOzRSUU0IWlFNpRVCHUlLSd6B3FooooATNFLSUEirTh14pAM8VsaBpEmp36RquUByx9BSG5JI6zwpZnR/D91rEykZX5c0eC3M8l7O/JbvW94mmt4/Bktnb4xGADisPwIn+h3B9TTTOWbTRn/ABFfm2X/AGQa8+au4+Icoa/gi9EFcOetZy3Oqj8JTFPXrUYp4PNZI7Geg/DmUfbZIv73NejWBhh8RWzSsFbPGa8h8Eaith4ghLn5XO05rtviQXtJ7C4t5GXcMhlOK13Rwz0qXO98ZyhVstjciUHNXDBDrWl/McyKMZrzfU9bmtvDFnczMZpMj7xzVjwf4+aTUxazxhI37ioSsaKS3JNX8OrdkpIxUjsa46XwuP7QEEbjGeTXpXjS7a2QXVogdcfPjtXmJ8TmO7M/kkn0JrS2hSmmdbYX0vgXSp3jIlEnOPfFeZ6lqE2p38t1N9+Q5Na+s+KJNWthE0QRRXO5qLDYZozSZopiFzSikpRTEOFFFJTELRRRTGFLRRTFYKUUlL2oELRSUVQhaWko7UgFoAzRTkHzUCZYtLeS4mWKNSWJxXo1zbp4Q8LBsAXlwPxpfh34bBkOpXaDYOUDDrWD4+1s6nrrRKf3UHygUrmT10LzyM/geSWQ5Z+SaveBYj/Zjt6tWdNhfAK/QV0XgeNIfCz3UmAqgnJppmco6WOB8ey+Zr2B/CuK5ImtXX74Xuq3EoORvIH51kms5HZTjaKKYpy00U4CsjrZZgYxyo6nDKQc16H4one78M6XNIxZh3Nebx53jB716HqY83wbYt/dOKuLOSsrO4/xGceEbMe4rk9NuTa30UoOMNXVeKvk8MWS/Q1x9nhrmIP93cM0yYq6PYri9RoYXlQta3Qxk9BXmnifR20rUGUD9053IfY17Pqtpat4IRbYK21Bsxzg1zOveHp9S8Fx3Mq/6VEoPvtFGpDShI8fNJT3BUkEYIOKjoN1qhBTqSigBaUU0UtMQ7NFIKXNMBaKSlp3AKWkpaYmFGaKTFMQ6igDigCmAopaSigQ4da3fDWjvqmoKuP3acsfYc1ixoXdVAyScCvV9K0GXSfBkt1Cp+0ygHpzgmkzKc7Iuf2qtnp05hO2C3QhcdyK8ju5zdXck56uxNdr4lkbT/DNvbE4llYl/wAa4LNImktLnc3R/wCKBjHqBUt1qMum/DqGOMkGU4JFQXfPgaAfSoPEz+X4O0+L1NJuxUVdnBE5znqTTCaU9aaai52LYqinA0wGnCsjdkqHFehsPN8D2+P4W/rXnS16NpObrwayddrD+daROXELS4njFtuiWKf7IriUbbzXY+OX2W9lD6RiuJBo6k01eJ3/AIH8SXKaklldSmS3fgIa9WcXN9ZyIkYEBBXHt0r550i8NlqkE4/hYZr6FtNdE+jpJDGT+6ByvriquY1YWep4R4lsGsNZniK4XdkVimvQviDZyOkN8ybSw5/OvPc80jSk/dEoozSimaBRS4FFIApKcBxRimhWAUUoFLTEJS0UVSGJmlzSUUxDs0ZpKM0wF704U0CnD7woJOh8KaadR1iJMZVfmNe2faoYo0tGA2Ben0rz/wCHll5Vo98Y8sTtFdHq85sIZr6Y7QFIQH3FSzjqSvKyPMvGepm/1qQKcRRnAFc8jA8VJeTm4upJD/ExNVxwaDqgrRO8ky/gqIehUVT8bER6VYQjsM1oWaGbwlCoGfmGaxvHkwN7DAOiIDipkRSd52ONzSGlNNNQdtioKeKaKcKzN2PWvRvBR8/R7iHrjFecA16H8Mz511Nb5+8OlaRZzYj4Sr49cm+gT+7GBXH5rqvHpx4geP8AugCuVpMil8I4Ng8V6d8P/EcgtpbB2DOF/dhu5ry/PNaeiXj2eqW8qNjDjNVEK0OaJ6n4yjvL3wtJNeRLG0bfKB6V483WvcPEl22oeF8kfK0e7ivEpOHb602YUdNCI04CkxzT1GeKR0CUAGr1tptzdHEMEkh/2VJrUi8J6u4BGnzn/gBoIc7GABQBk11C+C9ZbpYyj6qasR+AdZfpasKdyPaHIbcUBT6V26fDjWW/5Y4qUfDbWf8AnjRdDuzhNppNpruW+HOsj/lh+lQP8P8AWlGfsxqk0HMzjcUFTXUv4J1teljIfotQSeE9YRfm0+f/AL4NO4cxzuKb3rSudNurTie3kj/3lIqgy4NFylIQVJGuXHvxUYq1ZJvuo19WFMlvQ9m8O29zpnhi2+zxhy5BbI6DFcd8QvETXdwthEw2xgbsetd699/ZfhEHoRCAv1xXhN3M9zcyTSHLMxJNI56cLyuQsaF5x9aaacvag6noeneFI/tHh9UIyAa4jxpMZNflHZQBXonw+QP4enY/wDNeW6/N5+sXDn+8RUyZlRXvmSaDRSGoO0qg07NMFOFZGw8V3PwyuPK8UQoTw/FcKtdJ4KnMHiizbOPmqkY1VeJp/ERCviu49DjFclmu1+Jq48R7v70YNcRVEU1oLUkRKurA85qMVIinIqkU1oezaXdpqvw+m28ywoVP5V5DMhErfWvT/hdHJHBci5AFtLnhuh4qn4z8Em2llvtPXdEeWUdqdjjjJQlqebgHNbXh7SX1fUorZATk849KzDCwcgjB6Yr174Y6KlpaPqFwoDH7pI7UNaGspq2h22iaBZ6PZJDHCu/HzMRzmtQBBngCvJfHPj25i1BrLTpdqR8M4PU1w8nifVpjua9lH0NTYz1Z77rZuntCtlcRwv6sRVXQpfsETC/1KKWRu+8cV4DJrF9J9+6lP/Aqi+3XBPM7/wDfVVygqbTufTy6xp4/5fIP++xTxrWnf8/kP/fYr5eN5L/z2f8AOk+2TH/lq/51HsjdVZI+npNZ07/n9h/77FY2vTG+tkXT9SiikBz98V89i7m/56v/AN9UfbLgdJ5B+NUqdiJXnufRuivcx2wS+uI5X7FSK1flb0Oa+Yk1a+T7t3KP+BVah8R6rEQVvpeP9qjkZPLyo+gNZ0S01WykhkhXeV4bHevn/XNLfS9SmtnGNrcV6D4E8czT3IsdQk3FvuuTS/E/R1mSPUIF/wB4imnYzvY8oK960NHiMmpW6gZJYVFb2stxII40LMTjAr1bwb4Pg0qJb/UAPMxlQ38NUOU0VfiJqAs9Bs7FeHZRn6YryUnNd98TI55dUW4Zt8BGEI6V5+xoKpLqIaetRg08dKRq0eueCW+zeB72cnHymvILuXzbmV/Via9UtpvsHwtmYcGQV5I/JJ9TUtk0o63G5ppNLSGpOkrClFNp1Zo2FBrR0e4NtqkEw/hYVnVLE21w3oc1SImro734iv599azjo0Iya4eu18SAXfhu0vAckALmuJNUYQ2FzU9spknRB/EQKr1raBb+fq9suM/OM1SKlsdj4iv5dI0bT7a2kMRaMM2045ya6rwX4uttXtRY6gR52MDP8QrzjxneefqiwD7sChf61hWt5JaTrLE5V1OQQaq5zSp8yues6r4Ms73WVltJFjUtlkNaPizVovDOgx2Vq4ErJtGPSsTQ/EWnapZia+n8m5gGQc/erhvE2uSaxqbybiY14TntQ9jCEJc1mZM0zTSM7klmOSc1Fk9zSA5ApalM7FGwuaN3vSHNKsbPjAyfQVSHddQJoBqb7LMR/qn/AO+TR9km/wCeT/8AfJpicokW6l3VN9jn7RP/AN81C8bKSGGCOxqXcFJCE0oPem84ooTZTaZatbl7a4SVCQynIIr2zRruDxT4WMMrAuF2tnsfWvCga6nwb4iTSL0xXJb7PLw2D0qkc1WndaHpHhzw5pejySTvKszjndjha5rxv41NzK1hYPtiXgsD1qh4m8XQGNrPSAUib7z55NcIzktkk5oM6dJy3O8nkbVPAwdmLvEw5NcC3XFd14VYXPh29tyckAtiuGmG2Z19GIpNm9NW0GCpIxucCohV7S4vP1CCL+84oNJbHZ+I7v7J4Is7POPMQZFebk12XjuYLJa2iniJORXF1D3KpLQWmmjNFI1K1KKQUCszYdTl4NNFKOtNMlnoGnJ/aPgeWLq0WW/KuKPBIrr/AANOJILyzY8PGcD3rlr+I297LCRyrEVRzLSTRXrrPBEAk1J5SOI0LVydd14Ji8vTr+4PXyjimgm9Dmddm87Wrpwcgvx+VZvfmpbli9xI56ljUNMI7EgY9iaUnimipY42ZwAMn0plWS1EC5xUiQu3RSa9V+H/AIBhvYvtuopleqxnvWr4tl0LwpJGselRySP2x0qepE77o8djsLl8bIJDn/ZNdn4f0y10XTn1XVLfd/dRhTpPiIiDbDpUKenFc5r3iq81vCOFjiHRF6VoZe9I6VvH+nZ/d6VGF7fKKaPiBY/9AuL/AL5FeesRnikzRcr2KPSI/iDp7OA+lRbfZRVfxRo8Wo2sWq6XbnZJ95UHSvPwxBrpNE8Y3+ix+Um2SH+44zTuiXTa2MmSwuU+9BIPqpqBoXQfMpFduPiSXP7zSrdvX5ani8aaFe/u73R44w3BdaQ/eSPPSNtNzg12mveGYDb/ANpaUwktm5IHO2uMdSrEEc0FRakG4mjqabThSLtY7HwLKPtV1ATw0RxXM6rCYNRnjPZzWx4Qdl1tdv8AEpBqp4pi8vX7lR6g/pSZjH4jGrpPB9oJ9XDsPliG6ubFdv4YQWWi3d8/GVKg/hSKmzmvFN2brXblgcqGwKwzU91IZZnkJyWJNVs1NzemrRFNFJSZoLsQ0oFNBpc1majs0vamZpc00I2/DWoGw1iBycIWAb6VseMdL8i+W8iUmGcbtw9a5BDgg13OhazBqtj/AGRqBHTEbntVo56itK6OO6Guv8Iazb23m6fdnbFcLtDehNYWsaPcaTdtFKMr/Cw6EVnK5Ugg4Ipol+8jf8Q+Hp9JnLgb4H+ZHHcVgYOOetdt4f8AEMF9bjS9WO6NuEc/w1la/wCH5dLuCyjdbvyjjpTJUraMwo0LEY59q7fw5osNnbHVtTXbGoyinvVXwzoSMrajfEJbRDPPeqHiPxE+pz+TC221j4RR6Uwb5tEd74S+Idpb6rP9ufyrY8RgdsV102k6N47JvsvJGvCEHvXzqshz14rvfA3xAbw2Tb3C77U/mKhmkVZWZjeLtCk8P6zLbyLiMnMZ9q5snmuq8d+KY/E+rLcQpsjjXaua5MtVXHZC5pAaTNGaLiHZozTaM0APDYpd1R5pQaAaTOn8M+Ijps4t7g77WThlParXirQEtiNRs/ntZvmGO2a5BWwa6/wzr8aRtpt+PMt5OBk/dqjCUXF3RyZXBqWGJpnWNFLMxwMVua34emsr0GFDJDLzGVFbdhZWvhnTvt19ta7YfJH6UA6mg/T7O28Kaab29IN464RPSuK1C+k1G9lupPvOak1XVbjVrozTsTzwOwqrbwSTyiONSzE8AUMcV1ZLZWct5dLDEpLMcCuq8TXEek6DFpMTDzWwz4qxAlt4R0s3M4V76VfkX+7XBahfzX1088zbmY/lUsai5Mrlsio6WkJqGdKVgpDSZpM0FEQpaj8xP76/nS+Yn99fzrNGg+lqPzE/vr+dL5sf99fzouJkoNPjleNwysQwPBqDzY/76/nSiWP++v51UWS430PQ9I1az8Q2Q07VCFmUYjkNc9rWiXGk3JSQZj/hcdCKwYrpInDLIoI6ENXa6P4q0++tf7O1uSIoRhZWYfL+NaXRzSpyjqjlB8pBGQa7TQPFFs9t/Z+sjzLcfdPUisDWbOwspCbXVbK5iPK+XOrEfUZrEM0Of9dH/wB9Ci6Dl59zr/EviOO7AsbDKWidMcZrlCxNRGeL/nsh/wCBCk8+L/nqn/fQpXLjDlJt2KXefwqDz4v+eqf99Cl8+L/nqn/fQpXLsTFsnJoqHz4f+esf/fQpfPh/56p/30KdxcpLmjNRefF/z1T/AL6FJ58P/PVP++hRdC5WTZozUPnw5/1qf99Cl8+H/nqn/fQo5h2JM04GofPh/wCeqf8AfQo+0Q/89U/76FCYWZODT1cqQQeRVX7RD/z1T/voUv2iH/nsn/fQquYlxud3pHjn7Hp32e7gE7J/q2POK5zU9WuNVu2nnYknoOwrJFxBj/Wx/wDfQq3ZC3upxG15bRA/xSTKoH5mndEKmo6kltazXdwscKFmJxiuzghsfCNl9pusSX7D5E/u1WGsaH4XsytndWt5eMPvxyK4U/UGuKvtWe/umnuLhXZjnlhxUtgoOTLOqapcaneNPcOWJ7elZ5OTTDPEf+Wif99Cm+dF/wA9E/76FJs3jGxJTSaZ50f/AD0T/voUnnR/89F/MVNyrD6KZ5sf/PRP++hR5sf/AD0X86Vxn//Z" alt="Author Image" class="img img--headshot element--center">
        </div>
        
      
      <br>
      <span class="site__title">
        <a href="https://seantodd.co.uk/">Sean's Blog</a>
      </span>
      
      <p class="site__description">
         Friendly Neighbourhood SysAdmin. I write about my homelab and home network. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Sean's Blog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog/">
						<span>Blog</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tutorials/">
						<span>Tutorials</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/GigaByte4711" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Adding 2-Factor Authentication to any Web App using Nginx</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 20, 2019
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/blog">BLOG</a>
              •
          
              <a class="badge badge-category" href="/categories/work">WORK</a>
              
          
      
    
    
    
      
      
          <br>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/nginx">nginx</a>
           
      
          <a class="badge badge-tag" href="/tags/2fa">2fa</a>
           
      
          <a class="badge badge-tag" href="/tags/totp">totp</a>
           
      
          <a class="badge badge-tag" href="/tags/php">php</a>
           
      
          <a class="badge badge-tag" href="/tags/authentication">authentication</a>
          
      
    
    
    <br>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  
    <div class="toc-wrapper">
      <input type="checkbox" id="tocToggle">
      <label for="tocToggle">Table of Contents</label>
      
          <nav id="TableOfContents">
  <ul>
    <li><a href="#explaining-the-nginx-config">Explaining the Nginx Config</a>
      <ul>
        <li><a href="#handling-logging">Handling Logging</a></li>
        <li><a href="#the-main-configuration">The Main configuration</a></li>
      </ul>
    </li>
  </ul>
</nav>
      
    </div>
  
  
  <div class="post">
    <p>At work today, I was asked to add some form of authentication to one of our Web Apps. The app itself had no authentication built in and allowed users to submit URLs and files for analysis.
Obviously, we couldn’t put this Web App straight into production, as it would almost immediately be abused by our users.
Luckily, I already knew you could use Nginx as a reverse proxy, adding authentication to almost anything.</p>
<p>Getting Nginx to work as a reverse proxy is well-documented, and adding basic authentication is just a matter of writing passwords to a file, then editing your config.</p>
<p>But what if you needed something more robust?</p>
<p>My boss didn’t like the idea of people being able to guess/bruteforce user credentials, and I didn’t want to have to ssh into the proxy and edit a file every time we needed a new user, or a password had to be changed. There had to be something better.</p>
<p>I set about searching for an authentication front-end, with the ability for provisioning of new users.</p>
<p>This is where <a href="https://github.com/Arno0x/TwoFactorAuth">Arno0x’s Two Factor Auth</a> came into play. It provides a pretty front end for managing and creating authentication accounts, whilst also providing a backend to allow nginx to ensure the current user is authenticated.</p>
<p>Downloading and configuring the service is pretty straight-forward. My 2FA config file was simple, I just had to follow the readme on github.</p>
<p>The Nginx configuration needed a little more coaxing into life. I finally got it working with the following config:</p>
<pre><code class="language-nginxconf hljs" data-lang="nginxconf">
<span class="hljs-attribute">map</span> <span class="hljs-variable">$request_uri</span> <span class="hljs-variable">$loggable</span> {
/submit/api/<span class="hljs-attribute">submit</span> <span class="hljs-number">1</span>;
<span class="hljs-attribute">default</span> <span class="hljs-number">0</span>;
}

 <span class="hljs-attribute">log_format</span> phpcookie <span class="hljs-string">'<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>]  '</span>
 <span class="hljs-string">'"<span class="hljs-variable">$request</span>" <span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> '</span>
 <span class="hljs-string">'"<span class="hljs-variable">$http_referer</span>" "<span class="hljs-variable">$http_user_agent</span>" - "<span class="hljs-variable">$http_cookie</span>"'</span>;

<span class="hljs-section">server</span> {
<span class="hljs-attribute">root</span> /var/www/;
<span class="hljs-attribute">server_name</span> example.site;
<span class="hljs-attribute">index</span> index.php;


<span class="hljs-attribute">error_page</span> <span class="hljs-number">401</span> = <span class="hljs-variable">@error401</span>;

<span class="hljs-attribute">location</span> <span class="hljs-variable">@error401</span> {
    <span class="hljs-attribute">return</span> <span class="hljs-number">302</span> <span class="hljs-variable">$scheme</span>://<span class="hljs-variable">$host</span>/twofactorauth/login/login.php?from=<span class="hljs-variable">$uri</span>;
}

<span class="hljs-attribute">location</span> = /twofactorauth/nginx/auth.php {
    <span class="hljs-attribute">include</span> /etc/nginx/fastcgi.conf;
    <span class="hljs-attribute">fastcgi_param</span>  CONTENT_LENGTH <span class="hljs-string">""</span>;
    <span class="hljs-attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;
}

<span class="hljs-attribute">location</span> /twofactorauth/ {
<span class="hljs-attribute">index</span> index.php;
}

<span class="hljs-attribute">location</span> /twofactorauth/db/ {
    <span class="hljs-attribute">deny</span> all;
}

<span class="hljs-attribute">location</span> = /twofactorauth/login/login.php {
    <span class="hljs-attribute">allow</span> all;
    <span class="hljs-attribute">auth_request</span> <span class="hljs-literal">off</span>;
<span class="hljs-attribute">include</span> /etc/nginx/fastcgi.conf;
    <span class="hljs-attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;
}

<span class="hljs-attribute">location</span> <span class="hljs-regexp">~ \.php</span> {
	
    <span class="hljs-attribute">include</span> /etc/nginx/fastcgi.conf;
    <span class="hljs-attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;
}


<span class="hljs-attribute">location</span> /static/ {
<span class="hljs-attribute">alias</span> /var/www/html/static/;
}

<span class="hljs-attribute">location</span> / {
<span class="hljs-attribute">access_log</span> /var/log/nginx/cuckoo.log phpcookie if=<span class="hljs-variable">$loggable</span>;
<span class="hljs-attribute">proxy_pass</span>       http://127.0.0.1:8080;
<span class="hljs-attribute">auth_request</span> /twofactorauth/nginx/auth.php;
<span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">off</span>;
}
}
 
</code></pre><p>The majority of the config here is to handle what the reverse proxy serves itself, and what it passes to our webapp.</p>
<hr>
<h2 id="explaining-the-nginx-config">Explaining the Nginx Config</h2>
<h3 id="handling-logging">Handling Logging</h3>
<pre><code class="language-nginxconf hljs" data-lang="nginxconf"><span class="hljs-attribute">map</span> <span class="hljs-variable">$request_uri</span> <span class="hljs-variable">$loggable</span> {
/submit/api/<span class="hljs-attribute">submit</span> <span class="hljs-number">1</span>;
<span class="hljs-attribute">default</span> <span class="hljs-number">0</span>;
}

 <span class="hljs-attribute">log_format</span> phpcookie <span class="hljs-string">'<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>]  '</span>
 <span class="hljs-string">'"<span class="hljs-variable">$request</span>" <span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> '</span>
 <span class="hljs-string">'"<span class="hljs-variable">$http_referer</span>" "<span class="hljs-variable">$http_user_agent</span>" - "<span class="hljs-variable">$http_cookie</span>"'</span>;
</code></pre><p>This code handles how logging occurs. I wanted to log specific requests to the proxy, so I used these two paragraphs.</p>
<p>The first section defines what requests can be considered as ‘loggable’. Requests with the <code>1;</code> ending are considered candidates for logging, with the default being set as do not log. If the 0 and 1 were reversed, this would be a blacklisting operation instead.</p>
<p>The second section handles what format I want the log to use. In this case, I chose to include the <code>$http_cookie</code> option. This allows me to see which user made the request.</p>
<h3 id="the-main-configuration">The Main configuration</h3>
<h4 id="setting-the-servername-and-handling-authentication">Setting the servername and handling authentication</h4>
<pre><code class="language-nginxconf hljs" data-lang="nginxconf"><span class="hljs-section">server</span> {
<span class="hljs-attribute">root</span> /var/www/;
<span class="hljs-attribute">server_name</span> example.site;
<span class="hljs-attribute">index</span> index.php;


<span class="hljs-attribute">error_page</span> <span class="hljs-number">401</span> = <span class="hljs-variable">@error401</span>;

<span class="hljs-attribute">location</span> <span class="hljs-variable">@error401</span> {
    <span class="hljs-attribute">return</span> <span class="hljs-number">302</span> <span class="hljs-variable">$scheme</span>://<span class="hljs-variable">$host</span>/twofactorauth/login/login.php?from=<span class="hljs-variable">$uri</span>;
}
</code></pre><p>This defines the root directory for nginx to use, the server name to respond to and the what file to load when <a href="https://example.site/">https://example.site/</a> is requested.</p>
<p>This section also tells nginx what to do if the user has not been authenticated yet. In this case, instead of throwing a 401 error, the user is redirected to the 2FA login page, with the orginally requested page included in the URI. Once the user is authenticated, they’ll be redirected back to that URI.</p>
<h4 id="handling-php-and-the-2fa-application">Handling PHP and the 2FA application</h4>
<pre><code class="language-nginxconf hljs" data-lang="nginxconf"><span class="hljs-attribute">location</span> = /twofactorauth/nginx/auth.php {
    <span class="hljs-attribute">include</span> /etc/nginx/fastcgi.conf;
    <span class="hljs-attribute">fastcgi_param</span>  CONTENT_LENGTH <span class="hljs-string">""</span>;
    <span class="hljs-attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;
}

<span class="hljs-attribute">location</span> <span class="hljs-regexp">~ \.php</span> {

    <span class="hljs-attribute">include</span> /etc/nginx/fastcgi.conf;
    <span class="hljs-attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;
}

<span class="hljs-attribute">location</span> = /twofactorauth/login/login.php {
    <span class="hljs-attribute">allow</span> all;
    <span class="hljs-attribute">auth_request</span> <span class="hljs-literal">off</span>;
<span class="hljs-attribute">include</span> /etc/nginx/fastcgi.conf;
    <span class="hljs-attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;
}


<span class="hljs-attribute">location</span> /twofactorauth/ {
<span class="hljs-attribute">index</span> index.php;
}


<span class="hljs-attribute">location</span> /twofactorauth/db/ {
    <span class="hljs-attribute">deny</span> all;
}
</code></pre><p>Here, I’ve told nginx how to handle files with <code>.php</code> extensions. I basically let nginx know that any of these files are to be executed by <code>php7.2-fpm</code>. Nothing really special here.</p>
<p><code>auth_request off;</code> specifies that access to the 2FA login page is not subject to authentication. (if it was, we’d never be able to log in!)</p>
<p>I also defined the index file for requests to <a href="https://example.site/twofactoauth/">https://example.site/twofactoauth/</a> and specified that any access to the 2FA database folder is denied to everyone.</p>
<h4 id="handling-static-files-and-the-reverse-proxy">Handling static files and the reverse proxy</h4>
<pre><code class="language-nginxconf hljs" data-lang="nginxconf"><span class="hljs-attribute">location</span> /static/ {
<span class="hljs-attribute">alias</span> /var/www/html/static/;
}

<span class="hljs-attribute">location</span> / {
<span class="hljs-attribute">access_log</span> /var/log/nginx/cuckoo.log phpcookie;
<span class="hljs-comment">#access_log /var/log/nginx/cuckoo.log phpcookie if=$loggable;</span>
<span class="hljs-attribute">proxy_pass</span>       http://127.0.0.1:8080;
<span class="hljs-attribute">auth_request</span> /twofactorauth/nginx/auth.php;
<span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">off</span>;
}
}
</code></pre><p>The top secion of code ensures that static content is served from the Proxy, and not passed to the main webapp. This is to make sure that the larger resources aren’t being pulled over a potentially low-latency connection.</p>
<p>Next, we state that that we want a new log file to be created, using the previously set <code>phpcookie</code> format and validated against our previously set <code>loggable</code> whitelist.</p>
<p>I then set the reverse proxy destination to be our local <code>8080</code> port, and require authentication for this access.</p>
<p>Proxy buffering is diabled, as my WebApp uses streamed data and buffering can introduce breaking delays in this stream.</p>
<h5 id="and-thats-it-one-2fa-implementation-for-an-authentication-less-web-app">And that’s it! One 2FA implementation for an Authentication-less Web App!</h5>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/blog/hello-world/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Hello World!</span>
    </a>
    
    
    <a href="/blog/spam-spoofing-and-how-to-stop-them/" class="navigation-next">
      <span class="navigation-tittle">Spam Email - Or how I learned to love DMARC</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  




  
    


</article>


        </div>
        
    

<script defer="" data-savepage-src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script data-savepage-src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript"></script>
    





    



    

<div id="DownloadStatusBarContainer" style="height: auto; width: auto; display: block; --background:#333333; --backgroundHover:#666666; --button:transparent; --buttonHover:#444444; --buttonBorder:#555555; --border:#111111; --download:#666666; --progress:#222222; --text:#EEEEEE; --error:#73100D;"></div></body></html>